# WattBot RAG System

ä¸€å€‹åŸºæ–¼ Retrieval-Augmented Generation (RAG) çš„å•ç­”ç³»çµ±ï¼Œå°ˆé–€ç”¨æ–¼å¾å­¸è¡“ PDF æ–‡æª”ä¸­æå–ç²¾ç¢ºè³‡è¨Šã€‚æœ¬ç³»çµ±åˆ©ç”¨ LLM (Mistral 7B) å’Œå‘é‡æª¢ç´¢ (MPNet) ä¾†å›ç­”è¤‡é›œçš„æ•¸å€¼å’Œäº‹å¯¦æ€§å•é¡Œã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒè¨­ç½®

ç¢ºä¿å·²å®‰è£ Python 3.10+ å’Œ Ollamaã€‚

```bash
# å»ºç«‹ä¸¦å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
python -m venv venv
source venv/bin/activate

# å®‰è£ä¾è³´
pip install -r requirements.txt

# å•Ÿå‹• Ollama æ¨¡å‹ (éœ€å…ˆå®‰è£ Ollama)
ollama pull mistral:7b
ollama serve
```

### 2. åŸ·è¡Œ

**ç”Ÿæˆæ¸¬è©¦é›†ç­”æ¡ˆ (æäº¤ç”¨)**:
```bash
# é€™æœƒè®€å– data/test_Q.csvï¼Œç”Ÿæˆç­”æ¡ˆè‡³ artifacts/answers.csv
python -m scripts.main
```

**ä½¿ç”¨è¨“ç·´é›†è©•ä¼° (é–‹ç™¼ç”¨)**:
```bash
# é€™æœƒè®€å– data/train_QA.csvï¼Œç”Ÿæˆç­”æ¡ˆä¸¦è¨ˆç®—æº–ç¢ºç‡
python scripts/run_train.py
```

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

æœ¬ç³»çµ±æ¡ç”¨å…ˆé€²çš„ RAG ç®¡é“ï¼ŒåŒ…å«ä»¥ä¸‹å„ªåŒ–ï¼š

1.  **Hybrid Retrieval (æ··åˆæª¢ç´¢)**:
    *   **Embedding**: `sentence-transformers/all-mpnet-base-v2` (768ç¶­)
    *   **Query Expansion**: ä½¿ç”¨ LLM ç”Ÿæˆå‡è¨­æ€§ç­”æ¡ˆæ®µè½ï¼Œå¢å¼·èªç¾©åŒ¹é…ã€‚
    *   **Chunking**: 400 å­—ç¬¦çª—å£ + 150 å­—ç¬¦é‡ç–Šï¼Œæé«˜æª¢ç´¢ç²¾ç¢ºåº¦ã€‚

2.  **LLM Generation (ç”Ÿæˆ)**:
    *   **Model**: `ollama/mistral:7b` (æœ¬åœ°é‹è¡Œï¼Œç„¡éš±ç§èˆ‡è²»ç”¨å•é¡Œ)
    *   **Dynamic Few-Shot**: æ ¹æ“šå•é¡Œå‹•æ…‹å¾ `train_QA.csv` æª¢ç´¢æœ€ç›¸ä¼¼çš„å·²è§£æ±ºç¯„ä¾‹ï¼ŒæŒ‡å° LLM å›ç­”ã€‚
    *   **Robust Formatting**: å…§å»ºå¼·å¤§çš„ JSON è§£æå™¨ï¼Œèƒ½ä¿®å¾© LLM è¼¸å‡ºçš„æ ¼å¼éŒ¯èª¤ã€‚

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

*   `scripts/`
    *   `main.py`: ä¸»ç¨‹å¼ï¼Œç”¨æ–¼ç”Ÿæˆæ¸¬è©¦é›†ç­”æ¡ˆã€‚
    *   `run_train.py`: é–‹ç™¼è…³æœ¬ï¼Œç”¨æ–¼åœ¨è¨“ç·´é›†ä¸Šè©•ä¼°æº–ç¢ºç‡ã€‚
    *   `rag_pipeline.py`: æ ¸å¿ƒé‚è¼¯ï¼Œæ•´åˆæª¢ç´¢ã€æ“´å±•å’Œç”Ÿæˆã€‚
    *   `vector_store.py`: ç®¡ç† ChromaDB å‘é‡è³‡æ–™åº«ã€‚
    *   `embedder.py`: è™•ç†æ–‡æœ¬å‘é‡åŒ–ã€‚
    *   `llm_client.py`: è™•ç†èˆ‡ Ollama çš„é€šè¨Šã€‚
    *   `example_retriever.py`: å¯¦ç¾ Dynamic Few-Shot é‚è¼¯ã€‚
    *   `text_processor.py`: è™•ç† PDF æ–‡æœ¬åˆ†å¡Šã€‚
    *   `pdf_parser.py`: æå– PDF æ–‡æœ¬ã€‚
    *   `answer_formatter.py`: è§£æä¸¦è¦ç¯„åŒ– LLM è¼¸å‡ºã€‚
    *   `config.py`: æ‰€æœ‰é…ç½®åƒæ•¸ (æ¨¡å‹åç¨±ã€è·¯å¾‘ç­‰)ã€‚
*   `data/`: å­˜æ”¾å•é¡Œé›† (`test_Q.csv`, `train_QA.csv`)ã€‚
*   `artifacts/`: å­˜æ”¾ç”Ÿæˆçš„ç­”æ¡ˆå’ŒåŸå§‹ PDFã€‚

## ğŸ”§ å¸¸è¦‹å•é¡Œèˆ‡æ•…éšœæ’é™¤

*   **ç´¢å¼•é‡å»º**: å¦‚æœæ›´æ›äº†åˆ†å¡Šç­–ç•¥æˆ– Embedding æ¨¡å‹ï¼Œè«‹è¨­ç½®ç’°å¢ƒè®Šæ•¸ `RECREATE_INDEX=true` é‹è¡Œä¸€æ¬¡ã€‚
*   **é€Ÿç‡é™åˆ¶**: ä½¿ç”¨ Ollama æœ¬åœ°æ¨¡å‹ç„¡é€Ÿç‡é™åˆ¶ã€‚å¦‚ä½¿ç”¨ OpenAI/OpenRouterï¼Œè«‹æ³¨æ„ API é™åˆ¶ã€‚
*   **æº–ç¢ºç‡**: ç›®å‰åœ¨è¨“ç·´é›†ä¸Šçš„æº–ç¢ºç‡ç´„ç‚º 36.6%ã€‚ä¸»è¦é™åˆ¶åœ¨æ–¼ PDF è¡¨æ ¼è§£æå’Œè·¨æ®µè½æ¨ç†ã€‚
